<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="https://cdn.glitch.global/e605b8ff-1b81-42a6-81a5-17eabcdd19d1/slot-machine-32.ico?v=1666412745792" />

        <title>Expectorant</title>

        <!-- Meta tags for SEO and social sharing -->
        <link rel="canonical" href="https://glitch-hello-website.glitch.me/" />
        <meta name="description" content="Random bill splitting and generalized dice roller. Fairness in expectation!" />
        <meta name="robots" content="index,follow" />
        <meta property="og:title" content="Expectorant" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://expectorant.glitch.me/" />
        <meta property="og:description" content="Generalized dice-roller / Bernoulli-trialler. Exquisite fairness in expectation!" />
        <meta property="og:image" content="https://cdn.glitch.global/e605b8ff-1b81-42a6-81a5-17eabcdd19d1/slot-machine-32.ico?v=1666412745792" />
        <meta name="twitter:card" content="summary" />

        <link rel="stylesheet" href="/style.css" />
        <!--
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.min.css"/>
-->

        <script src="https://d3js.org/d3.v7.min.js"></script>
        <!-- <script src="/script.js" defer></script> -->

        <!-- for the spinner! -->
        <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js" integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="spinner.css" />
        <script src="spinner.js"></script>
    </head>
    <body>
        <!-- The wrapper and content divs set margins and positioning -->
        <div class="wrapper">
            <div class="content" role="main">
                <h1>Expectorant</h1>

                <h2>(This does not at all work yet what are you doing here?)</h2>

                <p>
                    <input id="expr" type="text" size="38" placeholder="Expression that evaluates to a probability" />
                    &nbsp; <span id="probpre">p=</span><span id="prob">0%</span>
                    <br />
                    <center>
                        <button id="expectorize" class="pushable">
                            <span class="front">
                                Expectorize
                            </span>
                        </button>
                    </center>

                    <audio id="audiotag1" src="https://cdn.glitch.global/e605b8ff-1b81-42a6-81a5-17eabcdd19d1/beepboop.wav?v=1666556484855" preload="auto"></audio>
                    <a href="javascript:play_single_sound();">Play</a>
                    <script type="text/javascript">
                        function play_single_sound() {
                            document.getElementById("audiotag1").play();
                        }
                    </script>
                </p>
<!-- We'll worry about instructions later.
<div class="instructions">
<p>
Instructions can go here later. Or check out 
<a href="http://messymatters.com/expectorant" title="Stochastic, Nerdtastic Restaurant Bill Splitting">the original blog post</a>.
</p>
</div>
-->
            </div>
            <!-- main -->
        </div>
        <!-- wrapper -->

        <div>
          <div id="my-spinner" class="spin_wrapper"></div>
        </div>
    </body>
    <script>
      // Eval but just return null if syntax error.
      // Obviously don't use serverside with user-supplied input.
      function laxeval(s) {
        try {
          const x = eval(s);
          return typeof x === "undefined" ? null : x;
        } catch (e) {
          return null;
        }
      }

      function parsefrac(s) {
        s = s.replace(/^([^\%]*)\%(.*)$/, "($1)/100$2");
        const x = laxeval(s);
        return x === null ? NaN : x;
      }

      $(document).ready(function(){
        // configure the spinner
        var slots = spinner.compute2Slots(0.5);
        var s = spinner.create($('#my-spinner'), slots);

        // configure button event
        $('#expectorize').click(function(e){
          e.preventDefault();
          spinner.start(s);
        });

        $('#expr').on("input propertychange",(e) => {
          // each time the prob changes, update the spinner
          try {
            // Convert the expression to a prob
            const prob = parsefrac(e.target.value);
            $("#prob").html(prob);
  
            // Set the spinner as needed
            if (isNaN(prob)) {
              spinner.setNan(s);
              return;
            }
            var slots = spinner.compute2Slots(Number(prob));
            spinner.update(s, slots);
          } catch (error) {
            spinner.setNan(s);
          }
        });

      });
    </script>

  <script>

    

    /*
// -----------------------------------------------------------------------------
// Macro-expand the syntactic sugar with `@` and `:`, namely:
//  * convert "t@a,b" to "((t)-(a))/((b)-(a))"
//  * convert "s:a,b,c" (any # of comma-separated items) to "(c)/((s)-(a)-(b))"
function desugar(s) {
  // "t @ a,b" -- t and a and b can be expressions
  if (/^[^\@\,\:]+\@[^\@\,\:]+\,[^\@\,\:]+$/.test(s)) {
    s = s.replace(
          "^\\s*([^\\@\\,]+)\\s*\\@\\s*([^\\,]+)\\,([^\\,]+)\\s*$",
          "(($1)-($2))/(($3)-($2))");
    // "s : a,b,c,..." -- for dinner bill splitting
  } else if (s.matches("^[^\\:\\,]+\\:[^\\:]+$")) {
    let ss = s.split("[\\:\\,]")
    int n = ss.length
    s = "("+ss[n-1]+")/(("+ss[0]+")"
    if(n >= 3) {
      for(int i = 1; i <= n-3; i++) s += "-("+ss[i]+")"
      s += "-(" + ss[n-2] + ")"
    }
    s += ")"
  }
  return s
}

  if(s.matches("^[^\\@\\,\\:]+\\@[^\\@\\,\\:]+\\,[^\\@\\,\\:]+$"))
    s = s.replaceFirst(
          "^\\s*([^\\@\\,]+)\\s*\\@\\s*([^\\,]+)\\,([^\\,]+)\\s*$",
          "(($1)-($2))/(($3)-($2))");
    // "s : a,b,c,..." -- for dinner bill splitting
    else if(s.matches("^[^\\:\\,]+\\:[^\\:]+$")) {
      let ss = s.split("[\\:\\,]")
      let n = ss.length
      s = "("+ss[n-1]+")/(("+ss[0]+")";
      if (n >= 3) {
        for (let i = 1; i <= n-3; i++) s += "-("+ss[i]+")";
        s += "-(" + ss[n-2] + ")";
      }
      s += ")"
    }
  return s
}
*/

  </script>
</html>